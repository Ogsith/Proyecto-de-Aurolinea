#include "clases.h"
using namespace std;

int getch() {
	struct termios oldt, newt;
	int ch;
	tcgetattr(STDIN_FILENO, &oldt);
	newt = oldt;
	newt.c_lflag &= ~(ICANON | ECHO);
	tcsetattr(STDIN_FILENO, TCSANOW, &newt);
	ch = cin.get();
	ch = getchar();
	tcsetattr(STDIN_FILENO, TCSANOW, &oldt);
	return ch;
}

int main() {
	int min_1 = 57;
	vector<vector<int>> nivel1 = {
		{1, 15},  {2, 5},   {2, 6},   {2, 7},   {2, 8},   {2, 9},   {2, 10},
		{2, 13},  {2, 14},  {2, 15},  {2, 16},  {2, 17},  {2, 18},  {2, 19},
		{2, 20},  {2, 22},  {2, 23},  {2, 24},  {2, 25},  {2, 26},  {3, 24},
		{4, 8},   {4, 9},   {4, 10},  {4, 11},  {4, 12},  {4, 13},  {4, 14},
		{4, 17},  {4, 18},  {4, 19},  {4, 20},  {4, 21},  {4, 22},  {4, 23},
		{4, 24},  {4, 27},  {4, 28},  {5, 3},   {5, 4},   {5, 10},  {5, 11},
		{5, 16},  {5, 17},  {5, 21},  {5, 22},  {6, 1},   {6, 2},   {6, 3},
		{6, 4},   {6, 5},   {6, 6},   {6, 7},   {6, 10},  {6, 11},  {6, 14},
		{6, 1},   {6, 16},  {6, 25},  {7, 1},   {7, 2},   {7, 3},   {7, 13},
		{7, 14},  {7, 15},  {7, 16},  {7, 19},  {7, 25},  {7, 26},  {8, 1},
		{8, 2},   {8, 3},   {8, 7},   {8, 8},   {8, 12},  {8, 13},  {8, 19},
		{8, 21},  {8, 22},  {8, 25},  {8, 26},  {8, 27},  {8, 28},  {9, 1},
		{9, 2},   {9, 3},   {9, 11},  {9, 12},  {9, 13},  {9, 17},  {9, 18},
		{9, 19},  {9, 21},  {9, 22},  {9, 28},  {10, 1},  {10, 2},  {10, 6},
		{10, 7},  {10, 8},  {10, 14}, {10, 15}, {10, 18}, {10, 21}, {10, 22},
		{10, 23}, {11, 1},  {11, 5},  {11, 6},  {11, 7},  {11, 8},  {11, 15},
		{11, 21}, {11, 22}, {11, 23}, {11, 24}, {11, 25}, {12, 4},  {12, 5},
		{12, 6},  {12, 8},  {12, 9},  {12, 10}, {12, 14}, {12, 15}, {12, 16},
		{12, 17}, {12, 19}, {12, 21}, {12, 22}, {12, 28}, {13, 8},  {13, 9},
		{13, 10}, {13, 11}, {13, 12}, {13, 19}, {13, 22}, {13, 25}, {13, 26},
		{13, 27}, {13, 28}, {14, 9},  {14, 12}, {14, 22}, {14, 24}, {14, 26},
		{14, 27}, {14, 28}, {15, 1},  {15, 2},  {15, 3},  {15, 6},  {15, 13},
		{15, 14}, {15, 15}, {15, 16}, {15, 20}, {15, 21}, {15, 22}, {15, 28},
		{16, 1},  {16, 2},  {16, 3},  {16, 6},  {16, 7},  {16, 10}, {16, 15},
		{16, 16}, {16, 17}, {16, 18}, {16, 21}, {17, 6},  {17, 7},  {17, 11},
		{17, 12}, {17, 19}, {17, 21}, {17, 23}, {18, 14}, {18, 15}, {18, 16},
		{18, 18}, {18, 19}, {18, 20}};
	int min_2 = 43;
	vector<vector<int>> nivel2 = {
		{1, 6},   {1, 10},  {1, 25},  {1, 26},  {2, 6},   {2, 8},   {2, 9},
		{2, 10},  {2, 11},  {2, 12},  {2, 13},  {2, 15},  {2, 16},  {2, 17},
		{2, 18},  {2, 21},  {2, 22},  {3, 6},   {3, 15},  {3, 16},  {3, 17},
		{3, 18},  {3, 19},  {3, 23},  {3, 24},  {3, 25},  {3, 28},  {4, 8},
		{4, 10},  {4, 11},  {4, 12},  {4, 13},  {4, 17},  {4, 18},  {4, 19},
		{4, 20},  {4, 24},  {4, 27},  {4, 28},  {5, 3},   {5, 4},   {5, 5},
		{5, 6},   {5, 7},   {5, 8},   {5, 11},  {5, 12},  {5, 17},  {5, 18},
		{5, 19},  {5, 20},  {5, 21},  {5, 27},  {5, 28},  {6, 2},   {6, 3},
		{6, 7},   {6, 8},   {6, 11},  {6, 12},  {6, 15},  {7, 3},   {7, 4},
		{7, 8},   {7, 9},   {7, 10},  {7, 12},  {7, 15},  {7, 16},  {7, 19},
		{7, 22},  {7, 23},  {7, 24},  {7, 27},  {8, 4},   {8, 16},  {8, 17},
		{8, 18},  {8, 19},  {8, 22},  {8, 23},  {8, 26},  {8, 27},  {9, 6},
		{9, 7},   {9, 14},  {9, 18},  {9, 19},  {9, 20},  {9, 21},  {9, 22},
		{10, 2},  {10, 7},  {10, 8},  {10, 9},  {10, 12}, {10, 13}, {10, 14},
		{10, 18}, {10, 19}, {10, 20}, {10, 21}, {10, 22}, {10, 27}, {10, 28},
		{11, 2},  {11, 3},  {11, 4},  {11, 9},  {11, 10}, {11, 14}, {11, 17},
		{11, 18}, {11, 19}, {11, 21}, {11, 24}, {11, 26}, {11, 27}, {11, 28},
		{12, 2},  {12, 3},  {12, 4},  {12, 5},  {12, 8},  {12, 9},  {12, 10},
		{12, 11}, {12, 16}, {12, 17}, {12, 18}, {12, 19}, {12, 21}, {12, 22},
		{12, 25}, {12, 26}, {12, 27}, {12, 28}, {13, 4},  {13, 5},  {13, 8},
		{13, 11}, {13, 12}, {13, 16}, {13, 17}, {13, 22}, {14, 11}, {14, 12},
		{14, 13}, {14, 22}, {14, 23}, {14, 28}, {15, 2},  {15, 3},  {15, 6},
		{15, 7},  {15, 11}, {15, 12}, {15, 15}, {15, 19}, {15, 23}, {15, 24},
		{15, 27}, {15, 28}, {16, 2},  {16, 3},  {16, 4},  {16, 5},  {16, 6},
		{16, 7},  {16, 8},  {16, 12}, {16, 15}, {16, 16}, {16, 19}, {16, 20},
		{17, 5},  {17, 6},  {17, 12}, {17, 13}, {18, 13}, {18, 14}, {18, 17},
		{18, 18}};

	int op;
	int a = 20;
	int b = 30;
	char d;
	int nivel = 0;
	int contador = 0;

	while (true) {
		menu();
		cout << "==> INGRESE OPCIÓN: ";
		cin >> op;

		if (op == 1) {
			system("clear");
			Cnivel level{};

			cout << "para ganar de verdad tendra que llegar a la salida en la "
					"minima cantidad de movimientos"
				 << endl;
			cout << "si hace muchos muchos movimientos innecesarios perdera, "
					"se recomienda mucha concentracion"
				 << endl;

			cout << "==> Elija entre el nivel 1 o el nivel 2: ";
			cin >> nivel;

			if (nivel == 1)
				level.construir_nivel(nivel1);
			else if (nivel == 2)
				level.construir_nivel(nivel2);
			else {
				cout << "ese nivel aun no existe, asi que iras al 1" << endl;
				level.construir_nivel(nivel1);
			}
			system("clear");

			string **lescenario = level.get_nivel();

			CPersonaje p("Rocky");
			p.inicial(lescenario, a, b);

			while (true) {
				level.mostrar_nivel();

				d = getch();
				contador++;

				p.movimiento(lescenario, a, b, d);
				system("clear");
				if (lescenario[a - 2][b - 5] == "R ") {
					if (nivel == 1 && contador == min_1) {
						cout << "¡¡¡¡eres un genio!!!!" << endl;
						gracias();
						break;
						contador = 0;
					} else if (nivel == 2 && contador == min_2) {
						cout << "¡¡¡¡eres un genio!!!!" << endl;
						gracias();
						break;
						contador = 0;
					} else {
						gracias();
						break;
						contador = 0;
					}
				}
				if (nivel == 1) {
					if (contador == min_1 + 5) {
						game_over();
						break;
					}
				} else if (nivel == 2) {
					if (contador == min_2 + 5) {
						game_over();
						break;
					}
				}
			}
		}

		else if (op == 0) {
			system("clear");
			cout << "\t*ADIÓS! NOS VEMOS PRONTO." << endl;
			break;
		}

		else {
			system("clear");
			cout << "\t*ERROR: Opción inválida." << endl;
			cout << "-----------------------------------------" << endl;
		}
	}
}